/* rivescript 1.19.0 -- built on 2018-03-04 01:22:22 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.RiveScript=a()}}(function(){var define,module,exports;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d,e,f,g;g=a("./utils"),f=a("./inheritance"),e=a("rsvp"),d=function(){function a(a){this.master=a,this.strict=a._strict,this.utf8=a._utf8,this._currentUser=null}return a.prototype.say=function(a){return this.master.say(a)},a.prototype.warn=function(a,b,c){return this.master.warn(a,b,c)},a.prototype.reply=function(a,b,c,d){var e,f;return this.say("Asked to reply to ["+a+"] "+b),this._currentUser=a,b=this.formatMessage(b),f="",this.master.getUservars(a)&&(this.master._users[a].__initialmatch__=void 0),this.master._topics.__begin__?(e=this._getReply(a,"request","begin",0,c),e.indexOf("{ok}")>-1&&(f=this._getReply(a,b,"normal",0,c),e=e.replace(/\{ok\}/g,f)),f=e,f=this.processTags(a,b,f,[],[],0,c)):f=this._getReply(a,b,"normal",0,c),f=this.processCallTags(f,c,d),g.isAPromise(f)?f.then(function(c){return function(d){return c.onAfterReply(b,a,d)}}(this)):this.onAfterReply(b,a,f),f},a.prototype.onAfterReply=function(a,b,c){return this.master._users[b].__history__.input.pop(),this.master._users[b].__history__.input.unshift(a),this.master._users[b].__history__.reply.pop(),this.master._users[b].__history__.reply.unshift(c),this._currentUser=void 0},a.prototype.processCallTags=function(a,b,c){var d,f,h,i,j,k,l,m,n,o,p,q,r,s,t;for(a=a.replace(/«__call__»/gi,"<call>"),a=a.replace(/«\/__call__»/gi,"</call>"),h=/<call>([\s\S]+?)<\/call>/gi,f=/«__call_arg__»([\s\S]*?)«\/__call_arg__»/gi,j=0,o={},q=[];;){if(++j>=50){this.warn("Infinite loop looking for call tag!");break}if(!(n=h.exec(a)))break;for(t=g.trim(n[1]),s=/(\S+)/gi.exec(t),r=s[0],d=[];;){if(!(m=f.exec(t)))break;d.push(m[1])}o[n[1]]={text:t,obj:r,args:d}}for(k in o){if(i=o[k],p="",this.master._objlangs[i.obj]?(l=this.master._objlangs[i.obj],p=this.master._handlers[l]?this.master._handlers[l].call(this.master,i.obj,i.args,b):"[ERR: No Object Handler]"):p=this.master.errors.objectNotFound,g.isAPromise(p)){if(c){q.push({promise:p,text:k});continue}p="[ERR: Using async routine with reply: use replyAsync instead]"}a=this._replaceCallTags(k,p,a)}return c?new e.Promise(function(b){return function(c,d){var f;return e.all(function(){var a,b,c;for(c=[],a=0,b=q.length;a<b;a++)f=q[a],c.push(f.promise);return c}()).then(function(d){var e,f,g;for(e=f=0,g=d.length;0<=g?f<g:f>g;e=0<=g?++f:--f)a=b._replaceCallTags(q[e].text,d[e],a);return c(a)}).catch(function(a){return d(a)})}}(this)):a},a.prototype._replaceCallTags=function(a,b,c){return c.replace(new RegExp("<call>"+g.quotemeta(a)+"</call>","i"),b)},a.prototype._parseCallArgsString=function(a){var b,c,d,e,f,g,h,i,j;for(i=[],b="",f=!1,j=/\s/gi,d=/"/gi,e=function(){return 0!==b.length&&i.push(b),b=""},g=0,h=a.length;g<h;g++)c=a[g],!c.match(j)||f?c.match(d)?(f&&e(),f=!f):b+=c:e();return e(),i},a.prototype._wrapArgumentsInCallTags=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(f=/<call>\s*(.*?)\s*<\/call>/gi,e=/<call>\s*[^\s]+ (.*)<\/call>/gi,g=[];;){if(!(m=f.exec(a)))break;for(o=m[0],q=o;;){if(!(d=e.exec(o)))break;for(n=d[1],c=this._parseCallArgsString(n),p=[],i=0,k=c.length;i<k;i++)b=c[i],p.push("«__call_arg__»"+b+"«/__call_arg__»");q=q.replace(n,p.join(" "))}g.push({original:o,wrapped:q})}for(j=0,l=g.length;j<l;j++)h=g[j],a=a.replace(h.original,h.wrapped);return a},a.prototype._getReply=function(a,b,c,d,e){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia;if(!this.master._sorted.topics)return this.warn("You forgot to call sortReplies()!"),"ERR: Replies Not Sorted";if(this.master.getUservars(a)||this.master.setUservar(a,"topic","random"),ea=this.master.getUservar(a,"topic"),aa=[],ca=[],Y="",this.master._topics[ea]||(this.warn("User "+a+" was in an empty topic named '"+ea+"'"),ea="random",this.master.setUservar(a,"topic",ea)),d>this.master._depth)return this.master.errors.deepRecursion;if("begin"===c&&(ea="__begin__"),this.master._users[a].__history__||(this.master._users[a].__history__={}),this.master._users[a].__history__.input&&0!==this.master._users[a].__history__.input.length||(this.master._users[a].__history__.input=["undefined","undefined","undefined","undefined","undefined","undefined","undefined","undefined","undefined","undefined"]),this.master._users[a].__history__.reply&&0!==this.master._users[a].__history__.reply.length||(this.master._users[a].__history__.reply=["undefined","undefined","undefined","undefined","undefined","undefined","undefined","undefined","undefined","undefined"]),!this.master._topics[ea])return"ERR: No default topic 'random' was found!";if(E=null,F=null,n=!1,0===d)for(h=[ea],(this.master._topics[ea].includes||this.master._topics[ea].inherits)&&(h=f.getTopicTree(this.master,ea)),t=0,x=h.length;t<x;t++)if(da=h[t],this.say("Checking topic "+da+" for any %Previous's"),this.master._sorted.thats[da].length){for(this.say("There's a %Previous in this topic!"),v=this.master._users[a].__history__.reply[0]||"undefined",v=this.formatMessage(v,!0),this.say("Last reply: "+v),P=this.master._sorted.thats[da],u=0,y=P.length;u<y;u++)if(fa=P[u],K=fa[1].previous,i=this.triggerRegexp(a,K),this.say("Try to match lastReply ("+v+") to "+i),(D=v.match(new RegExp("^"+i+"$")))&&(this.say("Bot side matched!"),ca=D,ca.shift(),ga=fa[1],W=this.triggerRegexp(a,ga.trigger),this.say('Try to match "'+b+'" against '+ga.trigger+" ("+W+")"),r=g.isAtomic(ga.trigger),s=!1,r?b===W&&(s=!0):(D=b.match(new RegExp("^"+W+"$")))&&(s=!0,aa=D,aa.length>=1&&aa.shift()),s)){E=ga,n=!0,F=ga.trigger;break}}else this.say("No %Previous in this topic!");if(!n)for(this.say("Searching their topic for a match..."),Q=this.master._sorted.topics[ea],G=0,z=Q.length;G<z;G++){if(fa=Q[G],K=fa[0],W=this.triggerRegexp(a,K),this.say('Try to match "'+b+'" against '+K+" ("+W+")"),r=g.isAtomic(K),s=!1,r)b===W&&(s=!0);else if((D=b.match(new RegExp("^"+W+"$")))&&(s=!0,aa=[],D.length>1))for(q=I=1,R=D.length;1<=R?I<=R:I>=R;q=1<=R?++I:--I)aa.push(D[q]);if(s){this.say("Found a match!"),E=fa[1],n=!0,F=K;break}}if(this.master._users[a].__lastmatch__=F,0===d&&(this.master._users[a].__initialmatch__=F,this.master._users[a].__last_triggers__=[]),E)for(this.master._users[a].__last_triggers__.push(E),S=[1],M=0,A=S.length;M<A;M++){if(S[M],null!=E.redirect){this.say("Redirecting us to "+E.redirect),O=this.processTags(a,b,E.redirect,aa,ca,d,e),O=this.processCallTags(O,e,!1),this.say("Pretend user said: "+O),Y=this._getReply(a,O,c,d+1,e);break}for(T=E.condition,N=0,B=T.length;N<B;N++)if($=T[N],(p=$.split(/\s*=>\s*/))&&2===p.length&&(l=p[0].match(/^(.+?)\s+(==|eq|!=|ne|<>|<|<=|>|>=)\s+(.*?)$/))){if(w=g.strip(l[1]),m=l[2],Z=g.strip(l[3]),L=p[1].trim(),w=this.processTags(a,b,w,aa,ca,d,e),Z=this.processTags(a,b,Z,aa,ca,d,e),w=this.processCallTags(w,e,!1),Z=this.processCallTags(Z,e,!1),0===w.length&&(w="undefined"),0===Z.length&&(Z="undefined"),this.say("Check if "+w+" "+m+" "+Z),J=!1,"eq"===m||"=="===m)w===Z&&(J=!0);else if("ne"===m||"!="===m||"<>"===m)w!==Z&&(J=!0);else try{w=parseInt(w),Z=parseInt(Z),"<"===m&&w<Z?J=!0:"<="===m&&w<=Z?J=!0:">"===m&&w>Z?J=!0:">="===m&&w>=Z&&(J=!0)}catch(a){a,this.warn("Failed to evaluate numeric condition!")}if(J){Y=L;break}}if(void 0!==Y&&Y.length>0)break;for(j=[],U=E.reply,_=0,C=U.length;_<C;_++)for(X=U[_],ia=1,D=X.match(/\{weight=(\d+?)\}/i),D&&(ia=D[1])<=0&&(this.warn("Can't have a weight <= 0!"),ia=1),q=ba=0,V=ia;0<=V?ba<=V:ba>=V;q=0<=V?++ba:--ba)j.push(X);k=parseInt(Math.random()*j.length),Y=j[k];break}if(n?void 0!==Y&&0!==Y.length||(Y=this.master.errors.replyNotFound):Y=this.master.errors.replyNotMatched,this.say("Reply: "+Y),"begin"===c){for(D=Y.match(/\{topic=(.+?)\}/i),o=0;D;){if(++o>=50){this.warn("Infinite loop looking for topic tag!");break}H=D[1],this.master.setUservar(a,"topic",H),Y=Y.replace(new RegExp("{topic="+g.quotemeta(H)+"}","ig"),""),D=Y.match(/\{topic=(.+?)\}/i)}for(D=Y.match(/<set (.+?)=(.+?)>/i),o=0;D;){if(++o>=50){this.warn("Infinite loop looking for set tag!");break}H=D[1],ha=D[2],this.master.setUservar(a,H,ha),Y=Y.replace(new RegExp("<set "+g.quotemeta(H)+"="+g.quotemeta(ha)+">","ig"),""),D=Y.match(/<set (.+?)=(.+?)>/i)}}else Y=this.processTags(a,b,Y,aa,ca,d,e);return Y},a.prototype.formatMessage=function(a,b){return a=""+a,a=a.toLowerCase(),a=this.substitute(a,"sub"),this.utf8?(a=a.replace(/[\\<>]+/,""),null!=this.master.unicodePunctuation&&(a=a.replace(this.master.unicodePunctuation,"")),null!=b&&(a=a.replace(/[.?,!;:@#$%^&*()]/,""))):a=g.stripNasties(a,this.utf8),a=a.trim(),a=a.replace(/\s+/g," ")},a.prototype.triggerRegexp=function(a,b){var c,d,e,f,h,i,j,k,l,m,n,o,p,q,r,s;for(b=b.replace(/^\*$/,"<zerowidthstar>"),b=b.replace(/\*/g,"(.+?)"),b=b.replace(/#/g,"(\\d+?)"),b=b.replace(/_/g,"(\\w+?)"),b=b.replace(/\s*\{weight=\d+\}\s*/g,""),b=b.replace(/<zerowidthstar>/g,"(.*?)"),b=b.replace(/\|{2,}/,"|"),b=b.replace(/(\(|\[)\|/g,"$1"),b=b.replace(/\|(\)|\])/g,"$1"),this.utf8&&(b=b.replace(/\\@/,"\\u0040")),j=b.match(/\[(.+?)\]/),c=0;j;){if(c++>50)return this.warn("Infinite loop when trying to process optionals in a trigger!"),"";for(o=j[1].split("|"),m=[],e=0,h=o.length;e<h;e++)n=o[e],m.push("(?:\\s|\\b)+"+n+"(?:\\s|\\b)+");p=m.join("|"),p=p.replace(new RegExp(g.quotemeta("(.+?)"),"g"),"(?:.+?)"),p=p.replace(new RegExp(g.quotemeta("(\\d+?)"),"g"),"(?:\\d+?)"),p=p.replace(new RegExp(g.quotemeta("(\\w+?)"),"g"),"(?:\\w+?)"),p=p.replace(/\[/g,"__lb__").replace(/\]/g,"__rb__"),b=b.replace(new RegExp("\\s*\\["+g.quotemeta(j[1])+"\\]\\s*"),"(?:"+p+"|(?:\\b|\\s)+)"),j=b.match(/\[(.+?)\]/)}for(b=b.replace(/__lb__/g,"[").replace(/__rb__/g,"]"),b=b.replace(/\\w/,"[^\\s\\d]"),c=0;b.indexOf("@")>-1&&!(c++>50);)(j=b.match(/\@(.+?)\b/))&&(l=j[1],r="",this.master._array[l]&&(r="(?:"+this.master._array[l].join("|")+")"),b=b.replace(new RegExp("@"+g.quotemeta(l)+"\\b"),r));for(c=0;b.indexOf("<bot")>-1&&!(c++>50);)(j=b.match(/<bot (.+?)>/i))&&(l=j[1],r="",this.master._var[l]&&(r=g.stripNasties(this.master._var[l])),b=b.replace(new RegExp("<bot "+g.quotemeta(l)+">"),r.toLowerCase()));for(c=0;b.indexOf("<get")>-1&&!(c++>50);)(j=b.match(/<get (.+?)>/i))&&(l=j[1],r=this.master.getUservar(a,l),b=b.replace(new RegExp("<get "+g.quotemeta(l)+">","ig"),r.toLowerCase()));for(c=0,b=b.replace(/<input>/i,"<input1>"),b=b.replace(/<reply>/i,"<reply1>");(b.indexOf("<input")>-1||b.indexOf("<reply")>-1)&&!(c++>50);)for(q=["input","reply"],f=0,i=q.length;f<i;f++)for(s=q[f],d=k=1;k<=9;d=++k)b.indexOf("<"+s+d+">")>-1&&(b=b.replace(new RegExp("<"+s+d+">","g"),this.master._users[a].__history__[s][d]));return this.utf8&&b.indexOf("\\u")>-1&&(b=b.replace(/\\u([A-Fa-f0-9]{4})/,function(a,b){return String.fromCharCode(parseInt(b,16))})),b=b.replace(/\|{2,}/gm,"|")},a.prototype.processTags=function(a,b,c,d,e,f,h){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J;for(D=[""],D.push.apply(D,d),i=[""],i.push.apply(i,e),1===D.length&&D.push("undefined"),1===i.length&&i.push("undefined"),s=c.match(/\(@([A-Za-z0-9_]+)\)/i),m=0;s;){if(m++>this.master._depth){this.warn("Infinite loop looking for arrays in reply!");break}u=s[1],C=this.master._array[u]?"{random}"+this.master._array[u].join("|")+"{/random}":"\0@"+u+"\0",c=c.replace(new RegExp("\\(@"+g.quotemeta(u)+"\\)","ig"),C),s=c.match(/\(@([A-Za-z0-9_]+)\)/i)}for(c=c.replace(/\x00@([A-Za-z0-9_]+)\x00/g,"(@$1)"),c=this._wrapArgumentsInCallTags(c),c=c.replace(/<person>/gi,"{person}<star>{/person}"),c=c.replace(/<@>/gi,"{@<star>}"),c=c.replace(/<formal>/gi,"{formal}<star>{/formal}"),c=c.replace(/<sentence>/gi,"{sentence}<star>{/sentence}"),c=c.replace(/<uppercase>/gi,"{uppercase}<star>{/uppercase}"),c=c.replace(/<lowercase>/gi,"{lowercase}<star>{/lowercase}"),c=c.replace(/\{weight=\d+\}/gi,""),c=c.replace(/<star>/gi,D[1]),c=c.replace(/<botstar>/gi,i[1]),n=p=1,z=D.length;1<=z?p<=z:p>=z;n=1<=z?++p:--p)c=c.replace(new RegExp("<star"+n+">","ig"),D[n]);for(n=q=1,A=i.length;1<=A?q<=A:q>=A;n=1<=A?++q:--q)c=c.replace(new RegExp("<botstar"+n+">","ig"),i[n]);for(c=c.replace(/<input>/gi,this.master._users[a].__history__.input[0]||"undefined"),c=c.replace(/<reply>/gi,this.master._users[a].__history__.reply[0]||"undefined"),n=t=1;t<=9;n=++t)c.indexOf("<input"+n+">")>-1&&(c=c.replace(new RegExp("<input"+n+">","ig"),this.master._users[a].__history__.input[n])),c.indexOf("<reply"+n+">")>-1&&(c=c.replace(new RegExp("<reply"+n+">","ig"),this.master._users[a].__history__.reply[n]));for(c=c.replace(/<id>/gi,a),c=c.replace(/\\s/gi," "),c=c.replace(/\\n/gi,"\n"),c=c.replace(/\\#/gi,"#"),s=c.match(/\{random\}(.+?)\{\/random\}/i),m=0;s;){if(m++>this.master._depth){this.warn("Infinite loop looking for random tag!");break}y=[],H=s[1],y=H.indexOf("|")>-1?H.split("|"):H.split(" "),w=y[parseInt(Math.random()*y.length)],c=c.replace(new RegExp("\\{random\\}"+g.quotemeta(H)+"\\{\\/random\\}","ig"),w),s=c.match(/\{random\}(.+?)\{\/random\}/i)}for(l=["person","formal","sentence","uppercase","lowercase"],v=0,r=l.length;v<r;v++)for(I=l[v],s=c.match(new RegExp("{"+I+"}(.+?){/"+I+"}","i")),m=0;s;){if(++m>=50){this.warn("Infinite loop looking for "+I+" tag!");break}j=s[1],B="person"===I?this.substitute(j,"person"):g.stringFormat(I,j),c=c.replace(new RegExp("{"+I+"}"+g.quotemeta(j)+"{/"+I+"}","ig"),B),s=c.match(new RegExp("{"+I+"}(.+?){/"+I+"}","i"))}for(c=c.replace(/<call>/gi,"«__call__»"),c=c.replace(/<\/call>/gi,"«/__call__»");;){if(!(s=c.match(/<([^<]+?)>/)))break;s=s[1],x=s.split(" "),F=x[0].toLowerCase(),k="",x.length>1&&(k=x.slice(1).join(" ")),o="","bot"===F||"env"===F?(G="bot"===F?this.master._var:this.master._global,k.indexOf("=")>-1?(x=k.split("=",2),this.say("Set "+F+" variable "+x[0]+" = "+x[1]),G[x[0]]=x[1]):o=G[k]||"undefined"):"set"===F?(x=k.split("=",2),this.say("Set uservar "+x[0]+" = "+x[1]),this.master.setUservar(a,x[0],x[1])):"add"===F||"sub"===F||"mult"===F||"div"===F?(x=k.split("="),u=x[0],J=x[1],"undefined"===this.master.getUservar(a,u)&&this.master.setUservar(a,u,0),J=parseInt(J),isNaN(J)?o="[ERR: Math can't '"+F+"' non-numeric value '"+J+"']":isNaN(parseInt(this.master.getUservar(a,u)))?o="[ERR: Math can't '"+F+"' non-numeric user variable '"+u+"']":(C=parseInt(this.master.getUservar(a,u)),"add"===F?C+=J:"sub"===F?C-=J:"mult"===F?C*=J:"div"===F&&(0===J?o="[ERR: Can't Divide By Zero]":C/=J),""===o&&this.master.setUservar(a,u,C))):o="get"===F?this.master.getUservar(a,k):"\0"+s+"",c=c.replace(new RegExp("<"+g.quotemeta(s)+">"),o)}for(c=c.replace(/\x00/g,"<"),c=c.replace(/\x01/g,">"),s=c.match(/\{topic=(.+?)\}/i),m=0;s;){if(++m>=50){this.warn("Infinite loop looking for topic tag!");break}u=s[1],this.master.setUservar(a,"topic",u),c=c.replace(new RegExp("{topic="+g.quotemeta(u)+"}","ig"),""),s=c.match(/\{topic=(.+?)\}/i)}for(s=c.match(/\{@([^\}]*?)\}/),m=0;s;){if(++m>=50){this.warn("Infinite loop looking for redirect tag!");break}G=g.strip(s[1]),G=this.processCallTags(G,h,!1),this.say("Inline redirection to: "+G),E=this._getReply(a,G,"normal",f+1,h),c=c.replace(new RegExp("\\{@"+g.quotemeta(s[1])+"\\}","i"),E),s=c.match(/\{@([^\}]*?)\}/)}return c},a.prototype.substitute=function(a,b){var c,d,e,f,h,i,j,k,l,m;if(!this.master._sorted[b])return this.master.warn("You forgot to call sortReplies()!"),"";for(l="sub"===b?this.master._sub:this.master._person,f="sub"===b?this.master._submax:this.master._personmax,i="",h=null!=this.master.unicodePunctuation?a.replace(this.master.unicodePunctuation,""):a.replace(/[.,!?;:]/g,""),m=0,d=0,j=0;h.indexOf(" ")>-1;){if(++d>=1e3){this.warn("Too many loops when handling substitutions!");break}if(e=g.nIndexOf(h," ",f),k=h.substring(0,e),void 0!==(i=l[k]))a=a.replace(k,i);else for(;k.indexOf(" ")>-1;){if(++j>=1e3){this.warn("Too many loops when handling substitutions!");break}if(e=k.lastIndexOf(" "),k=k.substring(0,e),void 0!==(i=l[k])){a=a.replace(k,i);break}m++}c=h.indexOf(" "),h=h.substring(c+1),m++}return i=l[h],void 0!==i&&(a=a.replace(h,i)),a},a}(),b.exports=d},{"./inheritance":2,"./utils":7,rsvp:12}],2:[function(a,b,c){var d,e;e=function(a,b,c,d,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t;if(null==c&&(c=!1),null==d&&(d=0),null==f&&(f=0),null==g&&(g=0),d>a._depth)return a.warn("Deep recursion while scanning topic inheritance (gave up in topic "+b+")!"),[];if(a.say("Collecting trigger list for topic "+b+" (depth="+d+"; inheritance="+f+"; inherited="+g+")"),null==a._topics[b])return a.warn("Inherited or included topic '"+b+"' doesn't exist or has no triggers"),[];if(t=[],j=[],c){if(null!=a._thats[b])for(h in a._thats[b])if(a._thats[b].hasOwnProperty(h))for(q in a._thats[b][h])a._thats[b][h].hasOwnProperty(q)&&(p=a._thats[b][h][q],j.push([p.trigger,p]))}else if(null!=a._topics[b])for(r=a._topics[b],i=0,n=r.length;i<n;i++)s=r[i],j.push([s.trigger,s]);if(Object.keys(a._includes[b]).length>0)for(k in a._includes[b])a._includes[b].hasOwnProperty(k)&&(a.say("Topic "+b+" includes "+k),t.push.apply(t,e(a,k,c,d+1,f+1,!1)));if(Object.keys(a._inherits[b]).length>0)for(l in a._inherits[b])a._inherits[b].hasOwnProperty(l)&&(a.say("Topic "+b+" inherits "+l),t.push.apply(t,e(a,l,c,d+1,f+1,!0)));if(Object.keys(a._inherits[b]).length>0||g)for(m=0,o=j.length;m<o;m++)s=j[m],a.say("Prefixing trigger with {inherits="+f+"} "+s),t.push.apply(t,[["{inherits="+f+"}"+s[0],s[1]]]);else t.push.apply(t,j);return t},d=function(a,b,c){var e,f,g;if(null==c&&(c=0),c>a._depth)return a.warn("Deep recursion while scanning topic tree!"),[];g=[b];for(e in a._topics[b].includes)a._topics[b].includes.hasOwnProperty(e)&&g.push.apply(g,d(a,e,c+1));for(f in a._topics[b].inherits)a._topics[b].inherits.hasOwnProperty(f)&&g.push.apply(g,d(a,f,c+1));return g},c.getTopicTriggers=e,c.getTopicTree=d},{}],3:[function(require,module,exports){"use strict";var JSObjectHandler;JSObjectHandler=function(){function JSObjectHandler(a){this._master=a,this._objects={}}return JSObjectHandler.prototype.load=function(name,code){var e,source;if("function"==typeof code)return this._objects[name]=code;source='this._objects["'+name+'"] = function(rs, args) {\n'+code.join("\n")+"}\n";try{return eval(source)}catch(a){return e=a,this._master.warn("Error evaluating JavaScript object: "+e.message)}},JSObjectHandler.prototype.call=function(a,b,c,d){var e,f,g;if(!this._objects[b])return this._master.errors.objectNotFound;f=this._objects[b],g="";try{g=f.call(d,a,c)}catch(a){e=a,g="[ERR: Error when executing JavaScript object: "+e.message+"]"}return void 0===g&&(g=""),g},JSObjectHandler}(),module.exports=JSObjectHandler},{}],4:[function(a,b,c){"use strict";var d,e,f;f=a("./utils"),e="2.0",d=function(){function a(a){this.master=a,this.strict=a._strict,this.utf8=a._utf8}return a.prototype.say=function(a){return this.master.say(a)},a.prototype.warn=function(a,b,c){return this.master.warn(a,b,c)},a.prototype.parse=function(a,b,c){var d,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y;for(d={begin:{global:{},var:{},sub:{},person:{},array:{}},topics:{},objects:[]},U="random",C=0,h=!1,o=!1,O="",N="",M=[],j=null,"",p=null,E={concat:null!=(Q=this.master._concat)?Q:"none"},i={none:"",newline:"\n",space:" "},D=b.split("\n"),H=q=0,v=D.length;q<v;H=++q)if(B=D[H],C=H+1,B=f.strip(B),0!==B.length)if(o)B.indexOf("< object")>-1||B.indexOf("<object")>-1?(O.length>0&&d.objects.push({name:O,language:N,code:M}),O=N="",M=[],o=!1):M.push(B);else if(0!==B.indexOf("//"))if(0!==B.indexOf("#"))if(0!==B.indexOf("/*")){if(B.indexOf("*/")>-1)h=!1;else if(!h)if(B.length<2)this.warn("Weird single-character line '"+B+"' found (in topic "+U+")",a,C);else{for(g=B.substring(0,1),B=f.strip(B.substring(1)),B.indexOf(" //")>-1&&(B=f.strip(B.split(" //")[0])),"?"===g&&(Y=[B,"[*]"+B+"[*]","*"+B+"*","[*]"+B+"*","*"+B+"[*]"],g="+",B="("+Y.join("|")+")",this.say("Rewrote ?Keyword as +Trigger: "+B)),!0===this.master._forceCase&&"+"===g&&(B=B.toLowerCase()),S=this.checkSyntax(g,B),""!==S&&(this.strict&&"function"==typeof c?c.call(null,"Syntax error: "+S+" at "+a+" line "+C+" near "+g+" "+B):this.warn("Syntax error: "+S+" at "+a+" line "+C+" near "+g+" "+B+" (in topic "+U+")")),"+"===g&&(p=null),this.say("Cmd: "+g+"; line: "+B),R=D.slice(H+1),A=r=0,w=R.length;r<w;A=++r)if(G=R[A],G=f.strip(G),!(G.length<2)){if(F=G.substring(0,1),G=f.strip(G.substring(1)),"%"!==F&&"^"!==F)break;if(0===G.length)break;if(this.say("\tLookahead "+A+": "+F+" "+G),"+"===g){if("%"===F){p=G;break}p=null}if("!"!==g){if("^"!==g&&"%"!==F){if("^"!==F)break;void 0!==i[E.concat]?B+=i[E.concat]+G:B+=G}}else"^"===F&&(B+="<crlf>"+G)}switch(g){case"!":if(m=B.split("=",2),u=f.strip(m[0]).split(" "),X=V=L="",2===m.length&&(X=f.strip(m[1])),u.length>=1&&(V=f.strip(u[0]),u.length>=2&&(u.shift(),L=f.strip(u.join(" ")))),"array"!==V&&(X=X.replace(/<crlf>/g,"")),"version"===V){if(parseFloat(X)>parseFloat(e))return this.warn("Unsupported RiveScript version. We only support "+e,a,C),!1;continue}if(0===L.length){this.warn("Undefined variable name",a,C);continue}if(0===X.length){this.warn("Undefined variable value",a,C);continue}switch(V){case"local":this.say("\tSet local parser option "+L+" = "+X),E[L]=X;break;case"global":this.say("\tSet global "+L+" = "+X),d.begin.global[L]=X;break;case"var":this.say("\tSet bot variable "+L+" = "+X),d.begin.var[L]=X;break;case"array":if(this.say("\tSet array "+L+" = "+X),"<undef>"===X){d.begin.array[L]="<undef>";continue}for(P=X.split("<crlf>"),l=[],s=0,x=P.length;s<x;s++)W=P[s],W.indexOf("|")>-1?l.push.apply(l,W.split("|")):l.push.apply(l,W.split(" "));for(n=I=0,y=l.length;I<y;n=++I)k=l[n],l[n]=l[n].replace(/\\s/gi," ");l=l.filter(function(a){return""!==a}),d.begin.array[L]=l;break;case"sub":this.say("\tSet substitution "+L+" = "+X),d.begin.sub[L]=X;break;case"person":this.say("\tSet person substitution "+L+" = "+X),d.begin.person[L]=X;break;default:this.warn("Unknown definition type "+V,a,C)}break;case">":switch(T=f.strip(B).split(" "),V=T.shift(),L="",l=[],T.length>0&&(L=T.shift()),T.length>0&&(l=T),V){case"begin":case"topic":if("begin"===V&&(this.say("Found the BEGIN block."),V="topic",L="__begin__"),!0===this.master._forceCase&&(L=L.toLowerCase()),this.say("Set topic to "+L),j=null,U=L,this.initTopic(d.topics,U),J="",l.length>=2)for(K=0,z=l.length;K<z;K++)k=l[K],"includes"===k||"inherits"===k?J=k:""!==J&&(d.topics[U][J][k]=1);break;case"object":t="",l.length>0&&(t=l[0].toLowerCase()),""===t&&(this.warn("Trying to parse unknown programming language",a,C),t="javascript"),O=L,N=t,M=[],o=!0;break;default:this.warn("Unknown label type "+V,a,C)}break;case"<":V=B,"begin"===V||"topic"===V?(this.say("\tEnd the topic label."),U="random"):"object"===V&&(this.say("\tEnd the object label."),o=!1);break;case"+":this.say("\tTrigger pattern: "+B),this.initTopic(d.topics,U),j={trigger:B,reply:[],condition:[],redirect:null,previous:p},d.topics[U].triggers.push(j);break;case"-":if(null===j){this.warn("Response found before trigger",a,C);continue}null!==j.redirect&&this.warn("You can't mix @Redirects with -Replies",a,C),this.say("\tResponse: "+B),j.reply.push(B);break;case"*":if(null===j){this.warn("Condition found before trigger",a,C);continue}null!==j.redirect&&this.warn("You can't mix @Redirects with *Conditions",a,C),this.say("\tCondition: "+B),j.condition.push(B);break;case"%":case"^":continue;case"@":(j.reply.length>0||j.condition.length>0)&&this.warn("You can't mix @Redirects with -Replies or *Conditions",a,C),this.say("\tRedirect response to: "+B),j.redirect=f.strip(B);break;default:this.warn("Unknown command '"+g+"' (in topic "+U+")",a,C)}}}else{if(B.indexOf("*/")>-1)continue;h=!0}else this.warn("Using the # symbol for comments is deprecated",a,C);return d},a.prototype.stringify=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;for(null==a&&(a=this.master.deparse()),b=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;for(d=b?"\t":"",k=[],e=0,h=a.length;e<h;e++){if(o=a[e],k.push(d+"+ "+o.trigger),o.previous&&k.push(d+"% "+o.previous),o.condition)for(m=o.condition,f=0,i=m.length;f<i;f++)c=m[f],k.push(d+"* "+c.replace(/\n/gm,"\\n"));if(o.redirect&&k.push(d+"@ "+o.redirect),o.reply)for(n=o.reply,g=0,j=n.length;g<j;g++)(l=n[g])&&k.push(d+"- "+l.replace(/\n/gm,"\\n"));k.push("")}return k},u=["! version = 2.0","! local concat = none",""],r=["global","var","sub","person","array"],i=0,n=r.length;i<n;i++)if(c=r[i],null!=a.begin[c]&&Object.keys(a.begin[c]).length){s=a.begin[c];for(k in s)if(A=s[k],a.begin[c].hasOwnProperty(k))if("array"!==c)u.push("! "+c+" "+k+" = "+A);else{for(q=" ",j=0,o=A.length;j<o;j++)if(x=A[j],x.match(/\s+/)){q="|";break}u.push("! "+c+" "+k+" = "+A.join(q))}u.push("")}if(a.objects)for(m in a.objects)if(a.objects[m]&&a.objects[m]._objects)for(e in a.objects[m]._objects)u.push("> object "+e+" "+m),u.push(a.objects[m]._objects[e].toString().match(/function[^{]+\{\n*([\s\S]*)\}\;?\s*$/m)[1].trim().split("\n").map(function(a){return"\t"+a}).join("\n")),u.push("< object\n");for((null!=(t=a.begin.triggers)?t.length:void 0)&&(u.push("> begin\n"),u.push.apply(u,b(a.begin.triggers,"indent")),u.push("< begin\n")),z=Object.keys(a.topics).sort(function(a,b){return a-b}),z.unshift("random"),d=!1,l=0,p=z.length;l<p;l++)if(y=z[l],a.topics.hasOwnProperty(y)&&("random"!==y||!d)){if("random"===y&&(d=1),v=!1,w=[],"random"!==y||Object.keys(a.inherits[y]).length>0||Object.keys(a.includes[y]).length>0){"random"!==y&&(v=!0),h=[],g=[];for(f in a.inherits[y])a.inherits[y].hasOwnProperty(f)&&h.push(f);for(f in a.includes[y])a.includes[y].hasOwnProperty(f)&&g.push(f);g.length>0&&(g.unshift("includes"),w.push.apply(w,g),v=!0),h.length>0&&(h.unshift("inherits"),w.push.apply(w,h),v=!0)}v&&u.push(("> topic "+y+" "+w.join(" ")).trim()+"\n"),u.push.apply(u,b(a.topics[y],v)),v&&u.push("< topic\n")}return u.join("\n")},a.prototype.checkSyntax=function(a,b){var c,d,e,f,g,h,i,j;if("!"===a){if(!b.match(/^.+(?:\s+.+|)\s*=\s*.+?$/))return"Invalid format for !Definition line: must be '! type name = value' OR '! type = value'";if(b.match(/^array/)){if(b.match(/\=\s?\||\|\s?$/))return"Piped arrays can't begin or end with a |";if(b.match(/\|\|/))return"Piped arrays can't include blank entries"}}else if(">"===a){if(i=b.split(/\s+/),"begin"===i[0]&&i.length>1)return"The 'begin' label takes no additional arguments";if("topic"===i[0]){if(!this.master._forceCase&&b.match(/[^a-z0-9_\-\s]/))return"Topics should be lowercased and contain only letters and numbers";if(b.match(/[^A-Za-z0-9_\-\s]/))return"Topics should contain only letters and numbers in forceCase mode"}else if("object"===i[0]&&b.match(/[^A-Za-z0-9\_\-\s]/))return"Objects can only contain numbers and letters"}else if("+"===a||"%"===a||"@"===a){if(h=j=e=c=0,this.utf8){if(b.match(/[A-Z\\.]/))return"Triggers can't contain uppercase letters, backslashes or dots in UTF-8 mode"}else{if(b.match(/[^a-z0-9(|)\[\]*_#@{}<>=\/\s]/))return"Triggers may only contain lowercase letters, numbers, and these symbols: ( | ) [ ] * _ # { } < > = /";if(b.match(/\(\||\|\)/))return"Piped alternations can't begin or end with a |";if(b.match(/\([^\)].+\|\|.+\)/))return"Piped alternations can't include blank entries";if(b.match(/\[\||\|\]/))return"Piped optionals can't begin or end with a |";if(b.match(/\[[^\]].+\|\|.+\]/))return"Piped optionals can't include blank entries"}for(d=b.split(""),f=0,g=d.length;f<g;f++)switch(d[f]){case"(":h++;break;case")":h--;break;case"[":j++;break;case"]":j--;break;case"{":e++;break;case"}":e--;break;case"<":c++;break;case">":c--}if(0!==h)return"Unmatched parenthesis brackets";if(0!==j)return"Unmatched square brackets";if(0!==e)return"Unmatched curly brackets";if(0!==c)return"Unmatched angle brackets"}else if("*"===a&&!b.match(/^.+?\s*(?:==|eq|!=|ne|<>|<|<=|>|>=)\s*.+?=>.+?$/))return"Invalid format for !Condition: should be like '* value symbol value => response'";return""},a.prototype.initTopic=function(a,b){if(null==a[b])return a[b]={includes:{},inherits:{},triggers:[]}},a}(),b.exports=d},{"./utils":7}],5:[function(a,b,c){(function(c){"use strict";var d,e,f,g,h,i,j,k,l,m;i="1.19.0",f=a("./parser"),d=a("./brain"),m=a("./utils"),l=a("./sorting"),j=a("./inheritance"),e=a("./lang/javascript"),g=a("rsvp"),k=a("fs-readdir-recursive"),h=function(){function b(a){var b,c,g;if(null==a&&(a={}),this._debug=!!a.debug&&a.debug,this._strict=!a.strict||a.strict,this._depth=a.depth?parseInt(a.depth):50,this._utf8=!!a.utf8&&a.utf8,this._forceCase=!!a.forceCase&&a.forceCase,this._onDebug=a.onDebug?a.onDebug:null,this._concat=a.concat?a.concat:null,this.unicodePunctuation=new RegExp(/[.,!?;:]/g),this.errors={replyNotMatched:"ERR: No Reply Matched",replyNotFound:"ERR: No Reply Found",objectNotFound:"[ERR: Object Not Found]",deepRecursion:"ERR: Deep Recursion Detected"},"object"==typeof a.errors){c=a.errors;for(b in c)g=c[b],a.errors.hasOwnProperty(b)&&(this.errors[b]=g)}this._node={},this._runtime=this.runtime(),this.parser=new f(this),this.brain=new d(this),this._pending=[],this._loadCount=0,this._global={},this._var={},this._sub={},this._submax=1,this._person={},this._personmax=1,this._array={},this._users={},this._freeze={},this._includes={},this._inherits={},this._handlers={},this._objlangs={},this._topics={},this._thats={},this._sorted={},"object"==typeof a&&(a.debug&&(this._debug=!0),a.strict&&(this._strict=!0),a.depth&&(this._depth=parseInt(a.depth)),a.utf8&&(this._utf8=!0)),this._handlers.javascript=new e(this),this.say("RiveScript Interpreter v"+i+" Initialized."),this.say("Runtime Environment: "+this._runtime)}return b.prototype.version=function(){return i},b.prototype.Promise=g.Promise,b.prototype.runtime=function(){return c.browser?"web":(this._node.fs=a("fs"),"node")},b.prototype.say=function(a){if(!0===this._debug)return this._onDebug?this._onDebug(a):console.log(a)},b.prototype.warn=function(a,b,c){return null!=b&&null!=c&&(a+=" at "+b+" line "+c),this._onDebug?this._onDebug("[WARNING] "+a):console?console.error?console.error(a):console.log("[WARNING] "+a):window?window.alert(a):void 0},b.prototype.loadFile=function(a,b,c){var d,e,f,g;for("string"==typeof a&&(a=[a]),g=this._loadCount++,this._pending[g]={},e=0,f=a.length;e<f;e++)d=a[e],this.say("Request to load file: "+d),this._pending[g][d]=1,"web"===this._runtime?this._ajaxLoadFile(g,d,b,c):this._nodeLoadFile(g,d,b,c);return g},b.prototype._ajaxLoadFile=function(a,b,c,d){var e;return e=new XMLHttpRequest,e.open("GET",b,!0),e.onreadystatechange=function(f){return function(){var g;if(4===e.readyState)if(0===(g=e.status)||200===g){if(f.say("Loading file "+b+" complete."),f.parse(b,e.responseText,d),delete f._pending[a][b],0===Object.keys(f._pending[a]).length&&"function"==typeof c)return c.call(void 0,a)}else if(f.say("Ajax error! "+e.statusText+"; "+e.status),"function"==typeof d)return d.call(void 0,e.statusText,a)}}(this),e.send(null)},b.prototype._nodeLoadFile=function(a,b,c,d){return this._node.fs.readFile(b,function(e){return function(f,g){return f?void("function"==typeof d?d.call(void 0,f,a):e.warn(f)):(e.parse(b,""+g,d),delete e._pending[a][b],0===Object.keys(e._pending[a]).length&&"function"==typeof c?c.call(void 0,a):void 0)}}(this))},b.prototype.loadDirectory=function(a,b,c){var d,e;return"web"===this._runtime?void this.warn("loadDirectory can't be used on the web!"):(d=this._loadCount++,this._pending[d]={},e=[],null==c&&(c=function(){}),this._node.fs.stat(a,function(f){return function(g,h){var i,j,l,m,n,o,p;if(g)return c.call(void 0,g,d);if(!h.isDirectory())return c.call(void 0,a+" is not a directory",d)
;for(f.say("Loading batch "+d+" from directory "+a),j=k(a),l=0,n=j.length;l<n;l++)i=j[l],i.match(/\.(rive|rs)$/i)&&(f._pending[d][a+"/"+i]=1,e.push(a+"/"+i));for(p=[],m=0,o=e.length;m<o;m++)i=e[m],f.say("Parsing file "+i+" from directory"),p.push(f._nodeLoadFile(d,i,b,c));return p}}(this)))},b.prototype.stream=function(a,b){return this.say("Streaming code."),this.parse("stream()",a,b)},b.prototype.parse=function(a,b,c){var d,e,f,g,h,i,j,k,l,n,o,p,q,r,s,t,u,v,w;this.say("Parsing code!"),d=this.parser.parse(a,b,c),n=d.begin;for(u in n)if(w=n[u],d.begin.hasOwnProperty(u)){g="_"+u;for(k in w)v=w[k],"sub"!==u&&"person"!==u||(this[g+"max"]=Math.max(this[g+"max"],k.split(" ").length)),w.hasOwnProperty(k)&&("<undef>"===v?delete this[g][k]:this[g][k]=v);null!=this._global.debug&&(this._debug="true"===this._global.debug),null!=this._global.depth&&(this._depth=parseInt(this._global.depth)||50)}o=d.topics;for(s in o)if(e=o[s],d.topics.hasOwnProperty(s))for(null==this._includes[s]&&(this._includes[s]={}),null==this._inherits[s]&&(this._inherits[s]={}),m.extend(this._includes[s],e.includes),m.extend(this._inherits[s],e.inherits),null==this._topics[s]&&(this._topics[s]=[]),p=e.triggers,f=0,i=p.length;f<i;f++)t=p[f],this._topics[s].push(t),null!=t.previous&&(null==this._thats[s]&&(this._thats[s]={}),null==this._thats[s][t.trigger]&&(this._thats[s][t.trigger]={}),this._thats[s][t.trigger][t.previous]=t);for(q=d.objects,r=[],h=0,j=q.length;h<j;h++)l=q[h],this._handlers[l.language]?(this._objlangs[l.name]=l.language,r.push(this._handlers[l.language].load(l.name,l.code))):r.push(void 0);return r},b.prototype.sortReplies=function(){var a,b,c;this._sorted.topics={},this._sorted.thats={},this.say("Sorting triggers...");for(c in this._topics)this._topics.hasOwnProperty(c)&&(this.say("Analyzing topic "+c+"..."),a=j.getTopicTriggers(this,c),this._sorted.topics[c]=l.sortTriggerSet(a,!0),b=j.getTopicTriggers(this,c,!0),this._sorted.thats[c]=l.sortTriggerSet(b,!1));return this._sorted.sub=l.sortList(Object.keys(this._sub)),this._sorted.person=l.sortList(Object.keys(this._person))},b.prototype.deparse=function(){var a,b;b={begin:{global:m.clone(this._global),var:m.clone(this._var),sub:m.clone(this._sub),person:m.clone(this._person),array:m.clone(this._array),triggers:[]},topics:m.clone(this._topics),inherits:m.clone(this._inherits),includes:m.clone(this._includes),objects:{}};for(a in this._handlers)b.objects[a]={_objects:m.clone(this._handlers[a]._objects)};return null!=b.topics.__begin__&&(b.begin.triggers=b.topics.__begin__,delete b.topics.__begin__),this._debug&&(b.begin.global.debug=this._debug),50!==this._depth&&(b.begin.global.depth=this._depth),b},b.prototype.stringify=function(a){return this.parser.stringify(a)},b.prototype.write=function(a,b){return"web"===this._runtime?void this.warn("write() can't be used on the web!"):this._node.fs.writeFile(a,this.stringify(b),function(b){if(b)return this.warn("Error writing to file "+a+": "+b)})},b.prototype.setHandler=function(a,b){return void 0===b?delete this._handlers[a]:this._handlers[a]=b},b.prototype.setSubroutine=function(a,b){if(this._handlers.javascript)return this._objlangs[a]="javascript",this._handlers.javascript.load(a,b)},b.prototype.setGlobal=function(a,b){return void 0===b?delete this._global[a]:this._global[a]=b},b.prototype.setVariable=function(a,b){return void 0===b?delete this._var[a]:this._var[a]=b},b.prototype.setSubstitution=function(a,b){return void 0===b?delete this._sub[a]:(this._submax=Math.max(a.split(" ").length,this._submax),this._sub[a]=b)},b.prototype.setPerson=function(a,b){return void 0===b?delete this._person[a]:(this._personmax=Math.max(a.split(" ").length,this._personmax),this._person[a]=b)},b.prototype.setUservar=function(a,b,c){return this._users[a]||(this._users[a]={topic:"random"}),void 0===c?delete this._users[a][b]:("topic"===b&&this._forceCase&&(c=c.toLowerCase()),this._users[a][b]=c)},b.prototype.setUservars=function(a,b){var c,d;this._users[a]||(this._users[a]={topic:"random"}),d=[];for(c in b)b.hasOwnProperty(c)&&("topic"===c&&this._forceCase&&(b[c]=b[c].toLowerCase()),void 0===b[c]?d.push(delete this._users[a][c]):d.push(this._users[a][c]=b[c]));return d},b.prototype.getVariable=function(a){return void 0!==this._var[a]?this._var[a]:"undefined"},b.prototype.getUservar=function(a,b){return this._users[a]&&void 0!==this._users[a][b]?this._users[a][b]:"undefined"},b.prototype.getUservars=function(a){return void 0===a?m.clone(this._users):null!=this._users[a]?m.clone(this._users[a]):void 0},b.prototype.clearUservars=function(a){return void 0===a?this._users={}:delete this._users[a]},b.prototype.freezeUservars=function(a){return null!=this._users[a]?this._freeze[a]=m.clone(this._users[a]):this.warn("Can't freeze vars for user "+a+": not found!")},b.prototype.thawUservars=function(a,b){return null==b&&(b="thaw"),"string"!=typeof b&&(b="thaw"),null==this._freeze[a]?void this.warn("Can't thaw user vars: "+a+" wasn't frozen!"):"thaw"===b?(this.clearUservars(a),this._users[a]=m.clone(this._freeze[a]),delete this._freeze[a]):"discard"===b?delete this._freeze[a]:"keep"===b?(this.clearUservars(a),this._users[a]=m.clone(this._freeze[a])):this.warn("Unsupported thaw action!")},b.prototype.lastMatch=function(a){if(null!=this._users[a])return this._users[a].__lastmatch__},b.prototype.initialMatch=function(a){if(null!=this._users[a])return this._users[a].__initialmatch__},b.prototype.lastTriggers=function(a){if(null!=this._users[a])return this._users[a].__last_triggers__},b.prototype.getUserTopicTriggers=function(a){if(this.userVars=this.getUservars(a),null!=this.userVars)return j.getTopicTriggers(this,this.userVars.topic)},b.prototype.currentUser=function(){return void 0===this.brain._currentUser&&this.warn("currentUser() is intended to be called from within a JS object macro!"),this.brain._currentUser},b.prototype.reply=function(a,b,c){return this.brain.reply(a,b,c)},b.prototype.replyAsync=function(a,b,c,d){var e;return e=this.brain.reply(a,b,c,!0),d&&e.then(function(a){return function(b){return d.call(a,null,b)}}(this)).catch(function(a){return function(b){return d.call(a,b,null)}}(this)),e},b}(),b.exports=h}).call(this,a("_process"))},{"./brain":1,"./inheritance":2,"./lang/javascript":3,"./parser":4,"./sorting":6,"./utils":7,_process:11,fs:8,"fs-readdir-recursive":9,rsvp:12}],6:[function(a,b,c){var d,e;e=a("./utils"),c.sortTriggerSet=function(a,b,c){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;for(null==c&&(c=function(a){}),null==b&&(b=!0),B={0:[]},h=0,p=a.length;h<p;h++)K=a[h],b&&null!=K[1].previous||(w=K[0].match(/\{weight=(\d+)\}/i),M=0,w&&w[1]&&(M=w[1]),null==B[M]&&(B[M]=[]),B[M].push(K));for(F=[],C=Object.keys(B).sort(function(a,b){return b-a}),k=0,q=C.length;k<q;k++){for(y=C[k],c("Sorting triggers with priority "+y),i=-1,g=-1,I={},I[i]=d(),D=B[y],l=0,r=D.length;l<r;l++)K=D[l],z=K[0],c("Looking at trigger: "+z),w=z.match(/\{inherits=(\d+)\}/i),w?(i=parseInt(w[1]),i>g&&(g=i),c("Trigger belongs to a topic that inherits other topics. Level="+i),z=z.replace(/\{inherits=\d+\}/gi,""),K[0]=z):i=-1,null==I[i]&&(I[i]=d()),z.indexOf("_")>-1?(f=e.word_count(z),c("Has a _ wildcard with "+f+" words."),f>0?(null==I[i].alpha[f]&&(I[i].alpha[f]=[]),I[i].alpha[f].push(K)):I[i].under.push(K)):z.indexOf("#")>-1?(f=e.word_count(z),c("Has a # wildcard with "+f+" words."),f>0?(null==I[i].number[f]&&(I[i].number[f]=[]),I[i].number[f].push(K)):I[i].pound.push(K)):z.indexOf("*")>-1?(f=e.word_count(z),c("Has a * wildcard with "+f+" words."),f>0?(null==I[i].wild[f]&&(I[i].wild[f]=[]),I[i].wild[f].push(K)):I[i].star.push(K)):z.indexOf("[")>-1?(f=e.word_count(z),c("Has optionals with "+f+" words."),null==I[i].option[f]&&(I[i].option[f]=[]),I[i].option[f].push(K)):(f=e.word_count(z),c("Totally atomic trigger with "+f+" words."),null==I[i].atomic[f]&&(I[i].atomic[f]=[]),I[i].atomic[f].push(K));for(I[g+1]=I[-1],delete I[-1],J=Object.keys(I).sort(function(a,b){return a-b}),o=0,s=J.length;o<s;o++){for(j=J[o],c("ip="+j),E=["atomic","option","alpha","number","wild"],v=0,t=E.length;v<t;v++)for(m=E[v],n=Object.keys(I[j][m]).sort(function(a,b){return b-a}),x=0,u=n.length;x<u;x++)N=n[x],G=I[j][m][N].sort(function(a,b){return b.length-a.length}),F.push.apply(F,G);L=I[j].under.sort(function(a,b){return b.length-a.length}),A=I[j].pound.sort(function(a,b){return b.length-a.length}),H=I[j].star.sort(function(a,b){return b.length-a.length}),F.push.apply(F,L),F.push.apply(F,A),F.push.apply(F,H)}}return F},c.sortList=function(a){var b,c,d,f,g,h,i,j,k,l,m;for(m={},f=0,i=a.length;f<i;f++)g=a[f],c=e.word_count(g,!0),null==m[c]&&(m[c]=[]),m[c].push(g);for(k=[],l=Object.keys(m).sort(function(a,b){return b-a}),h=0,j=l.length;h<j;h++)d=l[h],b=m[d].sort(function(a,b){return b.length-a.length}),k.push.apply(k,b);return k},d=function(){return{atomic:{},option:{},alpha:{},number:{},wild:{},pound:[],under:[],star:[]}}},{"./utils":7}],7:[function(a,b,c){c.strip=function(a){return a=a.replace(/^[\s\t]+/,"").replace(/[\s\t]+$/,"").replace(/[\x0D\x0A]+/,"")},c.trim=function(a){return a=a.replace(/^[\x0D\x0A\s\t]+/,"").replace(/[\x0D\x0A\s\t]+$/,"")},c.extend=function(a,b){var c,d,e;d=[];for(c in b)e=b[c],b.hasOwnProperty(c)&&d.push(a[c]=e);return d},c.word_count=function(a,b){var c,d,e,f,g;for(g=[],g=b?a.split(/\s+/):a.split(/[\s\*\#\_\|]+/),e=0,c=0,d=g.length;c<d;c++)f=g[c],f.length>0&&e++;return e},c.stripNasties=function(a,b){return a=b?a.replace(/[\\<>]+/g,""):a.replace(/[^A-Za-z0-9 ]/g,"")},c.quotemeta=function(a){var b,c,d,e;for(e="\\.+*?[^]$(){}=!<>|:".split(""),c=0,d=e.length;c<d;c++)b=e[c],a=a.replace(new RegExp("\\"+b,"g"),"\\"+b);return a},c.isAtomic=function(a){var b,c,d,e;for(d=["*","#","_","(","[","<","@"],b=0,c=d.length;b<c;b++)if(e=d[b],a.indexOf(e)>-1)return!1;return!0},c.stringFormat=function(a,b){var c,d,e,f,g,h;if("uppercase"===a)return b.toUpperCase();if("lowercase"===a)return b.toLowerCase();if("sentence"===a)return b+="",(c=b.charAt(0).toUpperCase())+b.substring(1);if("formal"===a){for(h=b.split(/\s+/),f=[],d=0,e=h.length;d<e;d++)g=h[d],c=g.charAt(0).toUpperCase(),f.push(c+g.substring(1));return f.join(" ")}return content},c.clone=function(a){var b,d;if(null===a||"object"!=typeof a)return a;b=a.constructor();for(d in a)a.hasOwnProperty(d)&&(b[d]=c.clone(a[d]));return b},c.isAPromise=function(a){return a&&a.then&&a.catch&&a.finally&&"function"==typeof a.then&&"function"==typeof a.catch&&"function"==typeof a.finally},c.nIndexOf=function(a,b,c){return a.split(b,c).join(b).length}},{}],8:[function(a,b,c){},{}],9:[function(a,b,c){function d(a,b,c,h){h=h||"",c=c||[],b=b||e;var i=g.join(a,h);return f.existsSync(i)?(f.statSync(i).isDirectory()?f.readdirSync(i).filter(function(a,c){return b(a,c,i)}).forEach(function(e){d(a,b,c,g.join(h,e))}):c.push(h),c):c}function e(a){return"."!==a[0]}var f=a("fs"),g=a("path");b.exports=d},{fs:8,path:10}],10:[function(a,b,c){(function(a){function b(a,b){for(var c=0,d=a.length-1;d>=0;d--){var e=a[d];"."===e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}function d(a,b){if(a.filter)return a.filter(b);for(var c=[],d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c}var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,f=function(a){return e.exec(a).slice(1)};c.resolve=function(){for(var c="",e=!1,f=arguments.length-1;f>=-1&&!e;f--){var g=f>=0?arguments[f]:a.cwd();if("string"!=typeof g)throw new TypeError("Arguments to path.resolve must be strings");g&&(c=g+"/"+c,e="/"===g.charAt(0))}return c=b(d(c.split("/"),function(a){return!!a}),!e).join("/"),(e?"/":"")+c||"."},c.normalize=function(a){var e=c.isAbsolute(a),f="/"===g(a,-1);return a=b(d(a.split("/"),function(a){return!!a}),!e).join("/"),a||e||(a="."),a&&f&&(a+="/"),(e?"/":"")+a},c.isAbsolute=function(a){return"/"===a.charAt(0)},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(d(a,function(a,b){if("string"!=typeof a)throw new TypeError("Arguments to path.join must be strings");return a}).join("/"))},c.relative=function(a,b){function d(a){for(var b=0;b<a.length&&""===a[b];b++);for(var c=a.length-1;c>=0&&""===a[c];c--);return b>c?[]:a.slice(b,c-b+1)}a=c.resolve(a).substr(1),b=c.resolve(b).substr(1);for(var e=d(a.split("/")),f=d(b.split("/")),g=Math.min(e.length,f.length),h=g,i=0;i<g;i++)if(e[i]!==f[i]){h=i;break}for(var j=[],i=h;i<e.length;i++)j.push("..");return j=j.concat(f.slice(h)),j.join("/")},c.sep="/",c.delimiter=":",c.dirname=function(a){var b=f(a),c=b[0],d=b[1];return c||d?(d&&(d=d.substr(0,d.length-1)),c+d):"."},c.basename=function(a,b){var c=f(a)[2];return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return f(a)[3]};var g="b"==="ab".substr(-1)?function(a,b,c){return a.substr(b,c)}:function(a,b,c){return b<0&&(b=a.length+b),a.substr(b,c)}}).call(this,a("_process"))},{_process:11}],11:[function(a,b,c){function d(){if(!h){h=!0;for(var a,b=g.length;b;){a=g,g=[];for(var c=-1;++c<b;)a[c]();b=g.length}h=!1}}function e(){}var f=b.exports={},g=[],h=!1;f.nextTick=function(a){g.push(a),h||setTimeout(d,0)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=e,f.addListener=e,f.once=e,f.off=e,f.removeListener=e,f.removeAllListeners=e,f.emit=e,f.binding=function(a){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(a){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],12:[function(a,b,c){(function(d,e){!function(a,d){"object"==typeof c&&void 0!==b?d(c):"function"==typeof define&&define.amd?define(["exports"],d):d(a.RSVP=a.RSVP||{})}(this,function(b){"use strict";function c(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1}function f(a){var b=a._promiseCallbacks;return b||(b=a._promiseCallbacks={}),b}function g(a,b){if(2!==arguments.length)return za[a];za[a]=b}function h(a){var b=typeof a;return null!==a&&("object"===b||"function"===b)}function i(a){return"function"==typeof a}function j(a){return null!==a&&"object"==typeof a}function k(a){return null!==a&&"object"==typeof a}function l(){setTimeout(function(){for(var a=0;a<Da.length;a++){var b=Da[a],c=b.payload;c.guid=c.key+c.id,c.childGuid=c.key+c.childId,c.error&&(c.stack=c.error.stack),za.trigger(b.name,b.payload)}Da.length=0},50)}function m(a,b,c){1===Da.push({name:a,payload:{key:b._guidKey,id:b._id,eventName:a,detail:b._result,childId:c&&c._id,label:b._label,timeStamp:Ca(),error:za["instrument-with-stack"]?new Error(b._label):null}})&&l()}function n(a,b){var c=this;if(a&&"object"==typeof a&&a.constructor===c)return a;var d=new c(p,b);return v(d,a),d}function o(){return new TypeError("A promises callback cannot return that same promise.")}function p(){}function q(a){try{return a.then}catch(a){return Ha.error=a,Ha}}function r(a,b,c,d){try{a.call(b,c,d)}catch(a){return a}}function s(a,b,c){za.async(function(a){var d=!1,e=r(c,b,function(c){d||(d=!0,b!==c?v(a,c,void 0):x(a,c))},function(b){d||(d=!0,y(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,y(a,e))},a)}function t(a,b){b._state===Fa?x(a,b._result):b._state===Ga?(b._onError=null,y(a,b._result)):z(b,void 0,function(c){b!==c?v(a,c,void 0):x(a,c)},function(b){return y(a,b)})}function u(a,b,c){b.constructor===a.constructor&&c===F&&a.constructor.resolve===n?t(a,b):c===Ha?(y(a,Ha.error),Ha.error=null):i(c)?s(a,b,c):x(a,b)}function v(a,b){a===b?x(a,b):h(b)?u(a,b,q(b)):x(a,b)}function w(a){a._onError&&a._onError(a._result),A(a)}function x(a,b){a._state===Ea&&(a._result=b,a._state=Fa,0===a._subscribers.length?za.instrument&&m("fulfilled",a):za.async(A,a))}function y(a,b){a._state===Ea&&(a._state=Ga,a._result=b,za.async(w,a))}function z(a,b,c,d){var e=a._subscribers,f=e.length;a._onError=null,e[f]=b,e[f+Fa]=c,e[f+Ga]=d,0===f&&a._state&&za.async(A,a)}function A(a){var b=a._subscribers,c=a._state;if(za.instrument&&m(c===Fa?"fulfilled":"rejected",a),0!==b.length){for(var d=void 0,e=void 0,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?D(c,d,e,f):e(f);a._subscribers.length=0}}function B(){this.error=null}function C(a,b){try{return a(b)}catch(a){return Ia.error=a,Ia}}function D(a,b,c,d){var e=i(c),f=void 0,g=void 0;if(e){if((f=C(c,d))===Ia)g=f.error,f.error=null;else if(f===b)return void y(b,o())}else f=d;b._state!==Ea||(e&&void 0===g?v(b,f):void 0!==g?y(b,g):a===Fa?x(b,f):a===Ga&&y(b,f))}function E(a,b){var c=!1;try{b(function(b){c||(c=!0,v(a,b))},function(b){c||(c=!0,y(a,b))})}catch(b){y(a,b)}}function F(a,b,c){var d=this,e=d._state;if(e===Fa&&!a||e===Ga&&!b)return za.instrument&&m("chained",d,d),d;d._onError=null;var f=new d.constructor(p,c),g=d._result;if(za.instrument&&m("chained",d,f),e===Ea)z(d,f,a,b);else{var h=e===Fa?a:b;za.async(function(){return D(e,f,h,g)})}return f}function G(a,b,c){return a===Fa?{state:"fulfilled",value:c}:{state:"rejected",reason:c}}function H(a,b){return Ba(a)?new Ja(this,a,!0,b).promise:this.reject(new TypeError("Promise.all must be called with an array"),b)}function I(a,b){var c=this,d=new c(p,b);if(!Ba(a))return y(d,new TypeError("Promise.race must be called with an array")),d;for(var e=0;d._state===Ea&&e<a.length;e++)z(c.resolve(a[e]),void 0,function(a){return v(d,a)},function(a){return y(d,a)});return d}function J(a,b){var c=this,d=new c(p,b);return y(d,a),d}function K(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function L(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function M(){this.value=void 0}function N(a){try{return a.then}catch(a){return Na.value=a,Na}}function O(a,b,c){try{a.apply(b,c)}catch(a){return Na.value=a,Na}}function P(a,b){for(var c={},d=a.length,e=new Array(d),f=0;f<d;f++)e[f]=a[f];for(var g=0;g<b.length;g++){c[b[g]]=e[g+1]}return c}function Q(a){for(var b=a.length,c=new Array(b-1),d=1;d<b;d++)c[d-1]=a[d];return c}function R(a,b){return{then:function(c,d){return a.call(b,c,d)}}}function S(a,b){var c=function(){for(var c=this,d=arguments.length,e=new Array(d+1),f=!1,g=0;g<d;++g){var h=arguments[g];if(!f){if((f=V(h))===Oa){var i=new Ma(p);return y(i,Oa.value),i}f&&!0!==f&&(h=R(f,h))}e[g]=h}var j=new Ma(p);return e[d]=function(a,c){a?y(j,a):void 0===b?v(j,c):!0===b?v(j,Q(arguments)):Ba(b)?v(j,P(arguments,b)):v(j,c)},f?U(j,e,a,c):T(j,e,a,c)};return c.__proto__=a,c}function T(a,b,c,d){var e=O(c,d,b);return e===Na&&y(a,e.value),a}function U(a,b,c,d){return Ma.all(b).then(function(b){var e=O(c,d,b);return e===Na&&y(a,e.value),a})}function V(a){return!(!a||"object"!=typeof a)&&(a.constructor===Ma||N(a))}function W(a,b){return Ma.all(a,b)}function X(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function Y(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function Z(a,b){return Ba(a)?new Pa(Ma,a,b).promise:Ma.reject(new TypeError("Promise.allSettled must be called with an array"),b)}function $(a,b){return Ma.race(a,b)}function _(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function aa(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function ba(a,b){return j(a)?new Ra(Ma,a,b).promise:Ma.reject(new TypeError("Promise.hash must be called with an object"),b)}function ca(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function da(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function ea(a,b){return j(a)?new Sa(Ma,a,!1,b).promise:Ma.reject(new TypeError("RSVP.hashSettled must be called with an object"),b)}function fa(a){throw setTimeout(function(){throw a}),a}function ga(a){var b={resolve:void 0,reject:void 0};return b.promise=new Ma(function(a,c){b.resolve=a,b.reject=c},a),b}function ha(a,b,c){return Ba(a)?i(b)?Ma.all(a,c).then(function(a){for(var d=a.length,e=new Array(d),f=0;f<d;f++)e[f]=b(a[f]);return Ma.all(e,c)}):Ma.reject(new TypeError("RSVP.map expects a function as a second argument"),c):Ma.reject(new TypeError("RSVP.map must be called with an array"),c)}function ia(a,b){return Ma.resolve(a,b)}function ja(a,b){return Ma.reject(a,b)}function ka(a,b){return Ma.all(a,b)}function la(a,b){return Ma.resolve(a,b).then(function(a){return ka(a,b)})}function ma(a,b,c){return Ba(a)||j(a)&&void 0!==a.then?i(b)?(Ba(a)?ka(a,c):la(a,c)).then(function(a){for(var d=a.length,e=new Array(d),f=0;f<d;f++)e[f]=b(a[f]);return ka(e,c).then(function(b){for(var c=new Array(d),e=0,f=0;f<d;f++)b[f]&&(c[e]=a[f],e++);return c.length=e,c})}):Ma.reject(new TypeError("RSVP.filter expects function as a second argument"),c):Ma.reject(new TypeError("RSVP.filter must be called with an array or promise"),c)}function na(a,b){$a[Ta]=a,$a[Ta+1]=b,2===(Ta+=2)&&_a()}function oa(){var a=d.nextTick,b=d.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(b)&&"0"===b[1]&&"10"===b[2]&&(a=setImmediate),function(){return a(ta)}}function pa(){return void 0!==Ua?function(){Ua(ta)}:sa()}function qa(){var a=0,b=new Xa(ta),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){return c.data=a=++a%2}}function ra(){var a=new MessageChannel;return a.port1.onmessage=ta,function(){return a.port2.postMessage(0)}}function sa(){return function(){return setTimeout(ta,1)}}function ta(){for(var a=0;a<Ta;a+=2){(0,$a[a])($a[a+1]),$a[a]=void 0,$a[a+1]=void 0}Ta=0}function ua(){try{var b=a,c=b("vertx");return Ua=c.runOnLoop||c.runOnContext,pa()}catch(a){return sa()}}function va(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function wa(){za.on.apply(za,arguments)}function xa(){za.off.apply(za,arguments)}var ya={mixin:function(a){return a.on=this.on,a.off=this.off,a.trigger=this.trigger,a._promiseCallbacks=void 0,a},on:function(a,b){if("function"!=typeof b)throw new TypeError("Callback must be a function");var d=f(this),e=void 0;e=d[a],e||(e=d[a]=[]),-1===c(e,b)&&e.push(b)},off:function(a,b){var d=f(this),e=void 0,g=void 0;if(!b)return void(d[a]=[]);e=d[a],-1!==(g=c(e,b))&&e.splice(g,1)},trigger:function(a,b,c){var d=f(this),e=void 0;if(e=d[a])for(var g=0;g<e.length;g++)(0,e[g])(b,c)}},za={instrument:!1};ya.mixin(za);var Aa=void 0;Aa=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var Ba=Aa,Ca=Date.now||function(){return(new Date).getTime()},Da=[],Ea=void 0,Fa=1,Ga=2,Ha=new B,Ia=new B,Ja=function(){function a(a,b,c,d){this._instanceConstructor=a,this.promise=new a(p,d),this._abortOnReject=c,this._init.apply(this,arguments)}return a.prototype._init=function(a,b){var c=b.length||0;this.length=c,this._remaining=c,this._result=new Array(c),this._enumerate(b),0===this._remaining&&x(this.promise,this._result)},a.prototype._enumerate=function(a){for(var b=this.length,c=this.promise,d=0;c._state===Ea&&d<b;d++)this._eachEntry(a[d],d)},a.prototype._settleMaybeThenable=function(a,b){var c=this._instanceConstructor,d=c.resolve;if(d===n){var e=q(a);if(e===F&&a._state!==Ea)a._onError=null,this._settledAt(a._state,b,a._result);else if("function"!=typeof e)this._remaining--,this._result[b]=this._makeResult(Fa,b,a);else if(c===Ma){var f=new c(p);u(f,a,e),this._willSettleAt(f,b)}else this._willSettleAt(new c(function(b){return b(a)}),b)}else this._willSettleAt(d(a),b)},a.prototype._eachEntry=function(a,b){k(a)?this._settleMaybeThenable(a,b):(this._remaining--,this._result[b]=this._makeResult(Fa,b,a))},a.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===Ea&&(this._abortOnReject&&a===Ga?y(d,c):(this._remaining--,this._result[b]=this._makeResult(a,b,c),0===this._remaining&&x(d,this._result)))},a.prototype._makeResult=function(a,b,c){return c},a.prototype._willSettleAt=function(a,b){var c=this;z(a,void 0,function(a){return c._settledAt(Fa,b,a)},function(a){return c._settledAt(Ga,b,a)})},a}(),Ka="rsvp_"+Ca()+"-",La=0,Ma=function(){function a(b,c){this._id=La++,this._label=c,this._state=void 0,this._result=void 0,this._subscribers=[],za.instrument&&m("created",this),p!==b&&("function"!=typeof b&&K(),this instanceof a?E(this,b):L())}return a.prototype._onError=function(a){var b=this;za.after(function(){b._onError&&za.trigger("error",a,b._label)})},a.prototype.catch=function(a,b){return this.then(void 0,a,b)},a.prototype.finally=function(a,b){var c=this,d=c.constructor;return c.then(function(b){return d.resolve(a()).then(function(){return b})},function(b){return d.resolve(a()).then(function(){throw b})},b)},a}();Ma.cast=n,Ma.all=H,Ma.race=I,Ma.resolve=n,Ma.reject=J,Ma.prototype._guidKey=Ka,Ma.prototype.then=F;var Na=new M,Oa=new M,Pa=function(a){function b(b,c,d){return X(this,a.call(this,b,c,!1,d))}return Y(b,a),b}(Ja);Pa.prototype._makeResult=G;var Qa=Object.prototype.hasOwnProperty,Ra=function(a){function b(b,c){var d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],e=arguments[3];return _(this,a.call(this,b,c,d,e))}return aa(b,a),b.prototype._init=function(a,b){this._result={},this._enumerate(b),0===this._remaining&&x(this.promise,this._result)},b.prototype._enumerate=function(a){var b=this.promise,c=[];for(var d in a)Qa.call(a,d)&&c.push({position:d,entry:a[d]});var e=c.length;this._remaining=e;for(var f=void 0,g=0;b._state===Ea&&g<e;g++)f=c[g],this._eachEntry(f.entry,f.position)},b}(Ja),Sa=function(a){function b(b,c,d){return ca(this,a.call(this,b,c,!1,d))}return da(b,a),b}(Ra);Sa.prototype._makeResult=G;var Ta=0,Ua=void 0,Va="undefined"!=typeof window?window:void 0,Wa=Va||{},Xa=Wa.MutationObserver||Wa.WebKitMutationObserver,Ya="undefined"==typeof self&&void 0!==d&&"[object process]"==={}.toString.call(d),Za="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,$a=new Array(1e3),_a=void 0;_a=Ya?oa():Xa?qa():Za?ra():void 0===Va&&"function"==typeof a?ua():sa();if("object"==typeof self)self;else{if("object"!=typeof e)throw new Error("no global: `self` or `global` found");e}var ab;za.async=na,za.after=function(a){return setTimeout(a,0)};var bb=ia,cb=function(a,b){return za.async(a,b)};if("undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var db=window.__PROMISE_INSTRUMENTATION__;g("instrument",!0);for(var eb in db)db.hasOwnProperty(eb)&&wa(eb,db[eb])}var fb=(ab={asap:na,cast:bb,Promise:Ma,EventTarget:ya,all:W,allSettled:Z,race:$,hash:ba,hashSettled:ea,rethrow:fa,defer:ga,denodeify:S,configure:g,on:wa,off:xa,resolve:ia,reject:ja,map:ha},va(ab,"async",cb),va(ab,"filter",ma),ab);b.default=fb,b.asap=na,b.cast=bb,b.Promise=Ma,b.EventTarget=ya,b.all=W,b.allSettled=Z,b.race=$,b.hash=ba,b.hashSettled=ea,b.rethrow=fa,b.defer=ga,b.denodeify=S,b.configure=g,b.on=wa,b.off=xa,b.resolve=ia,b.reject=ja,b.map=ha,b.async=cb,b.filter=ma,Object.defineProperty(b,"__esModule",{value:!0})})}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:11}]},{},[5])(5)});